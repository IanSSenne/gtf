import{BlockLocation as M,world as u}from"mojang-minecraft";var a=class{matches(e,s){return{success:!1,error:"NOT IMPLEMENTED"}}setName(e){return this.name=e,this}},E=class{matches(e){return{success:!0,value:"",raw:"",push:!1}}setName(e){return this.name=e,this}},f=class extends a{constructor(e){super();this.literal=e}matches(e){return e===this.literal||e.startsWith(this.literal+" ")?{success:!0,value:null,raw:this.literal,push:!1}:{success:!1,error:`Expected '${this.literal}'`}}},N=class extends a{constructor(){super()}matches(e){return{success:!0,value:e,raw:e,push:!0}}},m=class extends a{constructor(){super()}matches(e){try{let s=e.match(/^(-*(?:\d+(?:\.\d+)*|(?:\.\d+)))/);if(s){let n=parseFloat(s[0]);return Number.isNaN(n)&&Array.isArray(s)?{success:!1,error:`Expected a number for '${this.name}'`}:{success:!0,value:n,raw:s[0],push:!0}}return{success:!1,error:`Expected a number for '${this.name}'`}}catch{return{success:!1,error:`Expected a number for '${this.name}'`}}}},D=class extends a{constructor(){super()}},r=class{constructor(e=new E){this.matcher=e,this.depth=0,this.actions=[]}bind(e){return this.actions.push(e),e.setDepth(this.depth+1),e}setDepth(e){this.depth=e,this.actions.forEach(s=>s.setDepth(e+1))}__add(e){this.actions.push(e),e.setDepth(this.depth+1)}__redirect(e){this.actions.push(...e.actions)}literal(e){return this.bind(new r(new f(e).setName(e)))}number(e){return this.bind(new r(new m().setName(e)))}string(e){return this.bind(new r(new N().setName(e)))}selector(e){return this.bind(new r(new D().setName(e)))}argument(e,s){return this.bind(new r(s.setName(e)))}executes(e){return this.bind(new r).executable=e,this}evaluate(e,s,n=[]){if(s.length===0)if(this.executable){try{this.executable(e,...n)}catch(o){return{success:!0,executionSuccess:!1,executionError:o}}return{success:!0,executionSuccess:!0}}else return{success:!1,error:"Unexpected end of command"};let c=this.matcher.matches(s.trim(),e);if(c.success===!0){let o=[];for(let i of this.actions){let h=i.evaluate(e,s.trim().substring(c.raw.length),c.push===!1?[...n]:[...n,c.value]);if(h.success)return h;o.push(h)}let g=Math.min(...o.map(i=>i.depth||1/0));return o.find(i=>i.depth===g)}else return{success:!1,error:c.error,depth:this.depth}}},l=new r,p=new Map;function v(t,e,s=[]){s.forEach(n=>{p.set(n,e),l.literal(n).__redirect(t)}),l.__add(t),p.set(t.matcher.name,e)}function _(t){return new r(new f(t))}var x=u.getDimension("overworld"),w=u.getDimension("nether"),b=u.getDimension("the end");function L(t){let e=new M(Math.floor(t.location.x),Math.floor(t.location.y),Math.floor(t.location.z));if(x.getEntitiesAtBlockLocation(e).includes(t))return x;if(w.getEntitiesAtBlockLocation(e).includes(t))return w;if(b.getEntitiesAtBlockLocation(e).includes(t))return b;throw new Error("Unable to locate player dimension")}u.events.beforeChat.subscribe(t=>{if(t.message.startsWith("-")){let e=t.message.substring(1),s=l.evaluate({event:t,sender:t.sender,dimension:L(t.sender)},e);t.cancel=!0,s.success===!1&&console.warn(s.error)}});var T=_("t"),d=T.argument("number",new m);d.number("foo").executes((t,e,s)=>{});d.literal("bar").executes((t,e)=>{});d.string("lol").executes((t,e,s)=>{});export{a as ArgumentMatcher,m as NumberArgumentMatcher,N as StringArgumentMatcher,l as commandRoot,p as helpMessages,_ as literal,v as registerCommand};
