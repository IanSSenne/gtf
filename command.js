import{BlockLocation as _,world as h}from"mojang-minecraft";var c=class{matches(e,t){return{success:!1,error:"NOT IMPLEMENTED"}}setName(e){return this.name=e,this}},f=class{matches(e){return{success:!0,value:"",raw:"",push:!1}}setName(e){return this.name=e,this}},u=class extends c{constructor(e){super(),this.literal=e}matches(e){return e===this.literal||e.startsWith(this.literal+" ")?{success:!0,value:null,raw:this.literal,push:!1}:{success:!1,error:`Expected '${this.literal}'`}}},p=class extends c{constructor(){super()}matches(e){return{success:!0,value:e,raw:e,push:!0}}},d=class extends c{constructor(){super()}matches(e){try{let t=e.match(/^(-*(?:\d+(?:\.\d+)*|(?:\.\d+)))/);if(t){let r=parseFloat(t[0]);return Number.isNaN(r)&&Array.isArray(t)?{success:!1,error:`Expected a number for '${this.name}'`}:{success:!0,value:r,raw:t[0],push:!0}}return{success:!1,error:`Expected a number for '${this.name}'`}}catch{return{success:!1,error:`Expected a number for '${this.name}'`}}}},m=class extends c{constructor(){super()}},n=class{constructor(e=new f){this.matcher=e,this.depth=0,this.actions=[]}bind(e){return this.actions.push(e),e.setDepth(this.depth+1,this),e}setDepth(e,t=this){this.parent=t,this.depth=e,this.actions.forEach(r=>r.setDepth(e+1))}get root(){return this?.parent?.root||this}__add(e){this.actions.push(e),e.setDepth(this.depth+1)}__redirect(e){this.actions.push(...e.actions)}literal(e){return this.bind(new n(new u(e).setName(e)))}number(e){return this.bind(new n(new d().setName(e)))}string(e){return this.bind(new n(new p().setName(e)))}selector(e){return this.bind(new n(new m().setName(e)))}argument(e,t){return this.bind(new n(t.setName(e)))}executes(e){return this.bind(new n).executable=e,this}evaluate(e,t,r=[]){if(t.length===0)if(this.executable){try{this.executable(e,...r)}catch(o){return{success:!0,executionSuccess:!1,executionError:o}}return{success:!0,executionSuccess:!0}}else return{success:!1,error:"Unexpected end of command"};let i=this.matcher.matches(t.trim(),e);if(i.success===!0){let o=[];for(let a of this.actions){let l=a.evaluate(e,t.trim().substring(i.raw.length),i.push===!1?[...r]:[...r,i.value]);if(l.success)return l;o.push(l)}let D=Math.min(...o.map(a=>a.depth||1/0));return o.find(a=>a.depth===D)}else return{success:!1,error:i.error,depth:this.depth}}},w=new n,x=new Map;function k(s,e,t=[]){t.forEach(r=>{x.set(r,e),w.literal(r).__redirect(s)}),w.__add(s),x.set(s.matcher.name,e)}function v(s){return new n(new u(s))}var E=h.getDimension("overworld"),b=h.getDimension("nether"),N=h.getDimension("the end");function L(s){let e=new _(Math.floor(s.location.x),Math.floor(s.location.y),Math.floor(s.location.z));if(E.getEntitiesAtBlockLocation(e).includes(s))return E;if(b.getEntitiesAtBlockLocation(e).includes(s))return b;if(N.getEntitiesAtBlockLocation(e).includes(s))return N;throw new Error("Unable to locate player dimension")}h.events.beforeChat.subscribe(s=>{if(s.message.startsWith("-")){let e=s.message.substring(1),t=w.evaluate({event:s,sender:s.sender,dimension:L(s.sender)},e);s.cancel=!0,t.success===!1&&console.warn(t.error)}});export{c as ArgumentMatcher,d as NumberArgumentMatcher,p as StringArgumentMatcher,w as commandRoot,x as helpMessages,v as literal,k as registerCommand};
